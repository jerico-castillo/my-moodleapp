<ion-content>
    <ion-refresher slot="fixed" [disabled]="!loaded" (ionRefresh)="refreshData($event)">
        <ion-refresher-content pullingText="{{ 'core.pulltorefresh' | translate }}"></ion-refresher-content>
    </ion-refresher>

    <core-search-box (onSubmit)="search($event)" (onClear)="clearSearch($event)"
        [placeholder]="'addon.messages.contactname' | translate" autocorrect="off" spellcheck="false" lengthCheck="2"
        [disabled]="!loaded" searchArea="AddonMessagesContacts"></core-search-box>

    <core-loading [hideUntil]="loaded" [message]="loadingMessage">
        <core-empty-box *ngIf="!hasContacts && searchString == ''" icon="fas-address-book"
            [message]="'addon.messages.contactlistempty' | translate"></core-empty-box>

        <core-empty-box *ngIf="!hasContacts && searchString != ''" icon="fas-address-book"
            [message]="'addon.messages.nousersfound' | translate"></core-empty-box>

        <ion-list *ngFor="let contactType of contactTypes"  class="ion-no-margin">
            <ng-container *ngIf="contacts[contactType] && (contacts[contactType].length > 0 || contactType === searchType)">
                <ion-item-divider>
                    <ion-label><h2>{{ 'addon.messages.type_' + contactType | translate }}</h2></ion-label>
                    <ion-note slot="end" class="ion-padding-end"><ion-badge>{{ contacts[contactType].length }}</ion-badge></ion-note>
                </ion-item-divider>
                <ng-container *ngFor="let contact of contacts[contactType]">
                    <!-- Don't show deleted users -->
                    <ion-item class="ion-text-wrap addon-messages-conversation-item" *ngIf="contact.profileimageurl || contact.profileimageurlsmall"
                        [title]="contact.fullname" (click)="gotoDiscussion(contact.id)" detail
                        [class.core-selected-item]="contact.id == discussionUserId">
                        <core-user-avatar [user]="contact" slot="start" [checkOnline]="contact.showonlinestatus"></core-user-avatar>
                        <ion-label><h2>{{ contact.fullname }}</h2></ion-label>
                    </ion-item>
                </ng-container>
            </ng-container>
        </ion-list>
    </core-loading>
</ion-content>
