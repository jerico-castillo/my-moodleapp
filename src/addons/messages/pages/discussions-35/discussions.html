<ion-content>
    <ion-refresher slot="fixed" [disabled]="!loaded" (ionRefresh)="refreshData($event)">
        <ion-refresher-content pullingText="{{ 'core.pulltorefresh' | translate }}"></ion-refresher-content>
    </ion-refresher>

    <core-search-box *ngIf="search.enabled" (onSubmit)="searchMessage($event)" (onClear)="clearSearch($event)"
        [placeholder]=" 'addon.messages.message' | translate" autocorrect="off" spellcheck="false" lengthCheck="2"
        [disabled]="!loaded" searchArea="AddonMessagesDiscussions"></core-search-box>

    <core-loading [hideUntil]="loaded" [message]="loadingMessage">

        <ion-list *ngIf="search.showResults"  class="ion-no-margin">
            <ion-item-divider>
                <ion-label>
                    <h2>{{ 'core.searchresults' | translate }}</h2>
                </ion-label>
                <ion-note slot="end" class="ion-padding-end"><ion-badge>{{ search.results.length }}</ion-badge></ion-note>
            </ion-item-divider>
            <ion-item class="ion-text-wrap" *ngFor="let result of search.results" [title]="result.fullname"
                (click)="gotoDiscussion(result.userid, result.messageid)"
                [class.core-selected-item]="result.userid == discussionUserId" class="addon-message-discussion">
                <core-user-avatar [user]="result" slot="start" [checkOnline]="result.showonlinestatus"></core-user-avatar>
                <ion-label>
                        <h2>{{ result.fullname }}</h2>
                    <p><core-format-text clean="true" singleLine="true" [text]="result.lastmessage" contextLevel="system"
                        [contextInstanceId]="0"></core-format-text></p>
                </ion-label>
            </ion-item>
        </ion-list>

        <ion-list *ngIf="!search.showResults"  class="ion-no-margin">
            <ion-item class="ion-text-wrap" *ngFor="let discussion of discussions" [title]="discussion.fullname"
            (click)="gotoDiscussion(discussion.message!.user)"
            [class.core-selected-item]="discussion.message!.user == discussionUserId" class="addon-message-discussion">
                <core-user-avatar [user]="discussion" slot="start" checkOnline="false"></core-user-avatar>
                <ion-label>
                    <h2>{{ discussion.fullname }}</h2>
                    <ion-note *ngIf="discussion.message!.timecreated > 0 || discussion.unread">
                        <span *ngIf="discussion.unread" class="core-primary-circle"></span>
                        <span *ngIf="discussion.message!.timecreated > 0">{{discussion.message!.timecreated / 1000 | coreDateDayOrTime}}</span>
                    </ion-note>
                    <p>
                        <core-format-text clean="true" singleLine="true" [text]="discussion.message!.message" contextLevel="system" [contextInstanceId]="0">
                        </core-format-text>
                    </p>
                </ion-label>
            </ion-item>
        </ion-list>

        <core-empty-box *ngIf="(!discussions || discussions.length <= 0) && !search.showResults" icon="far-comments"
        [message]="'addon.messages.nomessagesfound' | translate"></core-empty-box>

        <core-empty-box *ngIf="(!search.results || search.results.length <= 0) && search.showResults" icon="search"
        [message]="'core.noresults' | translate"></core-empty-box>
    </core-loading>
</ion-content>
