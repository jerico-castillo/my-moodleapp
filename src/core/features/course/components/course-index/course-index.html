<ion-header>
    <ion-toolbar>
        <ion-title>
            <h2 id="core-course-section-selector-label">{{ 'core.course.courseindex' | translate }}</h2>
        </ion-title>
        <ion-buttons slot="end">
            <ion-button fill="clear" (click)="closeModal()" [attr.aria-label]="'core.close' | translate">
                <ion-icon slot="icon-only" name="fas-times" aria-hidden="true"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>
<ion-content>
    <ion-list id="core-course-section-selector" role="listbox" aria-labelledby="core-course-section-selector-label">
        <ng-container *ngFor="let section of sections">
            <ion-item *ngIf="allSectionId == section.id" class="ion-text-wrap divider" (click)="selectSection($event, section)" button
                [class.item-current]="selectedId === section.id" detail="false">
                <ion-label>
                    <p class="item-heading">
                        <core-format-text [text]="section.name" contextLevel="course" [contextInstanceId]="course?.id">
                        </core-format-text>
                    </p>
                </ion-label>
            </ion-item>
            <ng-container *ngIf="allSectionId != section.id && !section.hiddenbynumsections &&
                    section.id != stealthModulesSectionId && section.uservisible !== false">
                <ion-item class="ion-text-wrap divider section" (click)="selectSection($event, section)"
                    [button]="section.visible !== 0 && section.uservisible !== false" [class.item-current]="selectedId === section.id"
                    [class.item-dimmed]="section.visible === 0" detail="false" sticky="true">
                    <ion-icon [name]="section.expanded ? 'fas-chevron-down' : 'fas-chevron-right'" flip-rtl slot="start"
                        class="expandable-status-icon" (click)="toggleExpand($event, section)"
                        [attr.aria-label]="(section.expanded ? 'core.collapse' : 'core.expand') | translate"
                        [attr.aria-expanded]="section.expanded" [attr.aria-controls]="'core-course-index-section-' + section.id">
                    </ion-icon>
                    <ion-label>
                        <p class="item-heading">
                            <core-format-text [text]="section.name" contextLevel="course" [contextInstanceId]="course?.id">
                            </core-format-text>
                        </p>
                    </ion-label>
                    <ion-badge *ngIf="section.highlighted && highlighted">{{highlighted}}</ion-badge>
                    <ion-icon name="fas-lock" *ngIf="section.availabilityinfo" slot="end" class="restricted"
                        [attr.aria-label]="'core.restricted' | translate"></ion-icon>
                </ion-item>
                <div [hidden]="!section.expanded" [id]="'core-course-index-section-' + section.id">
                    <ng-container *ngIf="section.expanded">
                        <ng-container *ngFor="let module of section.modules">
                            <ion-item [class.item-dimmed]="module.visible === 0"
                                *ngIf="module.visibleoncoursepage !== 0 && !module.noviewlink"
                                (click)="selectModule($event, section, module)" button>
                                <ion-icon class="completioninfo completion_none" name="" *ngIf="module.completionStatus === undefined"
                                    slot="start" aria-hidden="true"></ion-icon>
                                <ion-icon class="completioninfo completion_incomplete" name="far-circle"
                                    *ngIf="module.completionStatus === 0" slot="start" [attr.aria-label]="'core.course.todo' | translate">
                                </ion-icon>
                                <ion-icon class="completioninfo completion_complete" name="fas-circle"
                                    *ngIf="module.completionStatus === 1 || module.completionStatus === 2" color="success" slot="start"
                                    [attr.aria-label]="'core.course.done' | translate">
                                </ion-icon>
                                <ion-icon class="completioninfo completion_fail" name="fas-circle" *ngIf="module.completionStatus === 3"
                                    color="danger" slot="start" [attr.aria-label]="'core.course.failed' | translate">
                                </ion-icon>
                                <ion-label>
                                    <p class="item-heading">
                                        <core-format-text [text]="module.name" contextLevel="module" [contextInstanceId]="module.id"
                                            [courseId]="module.courseid">
                                        </core-format-text>
                                    </p>
                                </ion-label>
                                <ion-icon name="fas-lock" *ngIf="module.uservisible === false" slot="end" class="restricted"
                                    [attr.aria-label]="'core.restricted' | translate"></ion-icon>
                            </ion-item>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
    </ion-list>
</ion-content>
