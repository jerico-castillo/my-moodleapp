<ion-card *ngIf="module.handlerData && module.visibleoncoursepage !== 0">
    <ng-container *ngIf="!module.handlerData.loading">
        <ion-item id="core-course-module-{{module.id}}"
            class="ion-text-wrap core-course-module-handler core-module-main-item {{module.handlerData.class}}"
            (click)="moduleClicked($event)" [attr.aria-label]="module.handlerData.a11yTitle" [ngClass]="{
                'has-module-info': hasInfo,
                'item-media': module.handlerData.icon,
                'item-dimmed': module.visible === 0 || module.uservisible === false
            }" [button]="module.handlerData.action && module.uservisible" detail="false">

            <core-mod-icon slot="start" *ngIf="module.handlerData.icon" [modicon]="module.handlerData.icon" [modname]="module.modname"
                [componentId]="module.instance">
            </core-mod-icon>

            <ion-label class="core-module-title">
                <p class="item-heading">
                    <core-format-text [text]="module.handlerData.title" contextLevel="module" [contextInstanceId]="module.id"
                        [courseId]="module.course" [attr.aria-label]="module.handlerData.a11yTitle + ', ' + modNameTranslated">
                    </core-format-text>
                </p>
                <ion-chip class="completioninfo completion_incomplete" *ngIf="completionStatus === 0">
                    <ion-label>
                        <ion-icon name="fas-edit" aria-hidden="true"></ion-icon>
                        {{ 'core.course.todo' | translate }}
                    </ion-label>
                </ion-chip>
                <ion-chip class="completioninfo completion_complete" *ngIf="completionStatus === 1 || completionStatus === 2"
                    color="success">
                    <ion-icon name="fas-check" aria-hidden="true"></ion-icon>
                    <ion-label>{{'core.course.done' | translate }}</ion-label>
                </ion-chip>
                <ion-chip class="completioninfo completion_fail" *ngIf="completionStatus === 3" color="danger">
                    <ion-icon name="fas-times" aria-hidden="true"></ion-icon>
                    <ion-label>{{'core.course.failed' | translate }}</ion-label>
                </ion-chip>

                <ion-chip *ngIf="module.handlerData.extraBadge" [color]="module.handlerData.extraBadgeColor"
                    class="ion-text-wrap ion-text-start" [outline]="true">
                    <ion-label><span [innerHTML]="module.handlerData.extraBadge"></span></ion-label>
                </ion-chip>
            </ion-label>
            <!-- Buttons. -->
            <div slot="end" *ngIf="module.uservisible !== false" class="buttons core-module-buttons"
                [ngClass]="{'core-button-completion': module.completiondata && showLegacyCompletion}">
                <!-- Module completion (legacy). -->
                <core-course-module-completion-legacy *ngIf="module.completiondata && showLegacyCompletion"
                    [completion]="module.completiondata" [moduleName]="module.name" [moduleId]="module.id"
                    (completionChanged)="completionChanged.emit($event)">
                </core-course-module-completion-legacy>

                <div class="core-module-buttons-more">
                    <!-- Buttons defined by the module handler. -->
                    <ion-button fill="clear" *ngFor="let button of module.handlerData.buttons" color="dark" size="small"
                        [hidden]="button.hidden || module.handlerData.spinner" class="core-animate-show-hide"
                        (click)="buttonClicked($event, button)" [attr.aria-label]="button.label | translate:{$a: module.handlerData.title}">
                        <ion-icon [name]="button.icon" slot="icon-only" aria-hidden="true"></ion-icon>
                    </ion-button>
                </div>
            </div>
        </ion-item>
        <ion-item *ngIf="hasInfo" id="core-course-module-{{module.id}}-info"
            class="ion-text-wrap core-course-module-handler core-course-module-info {{module.handlerData.class}}" [ngClass]="{
                'item-media': module.handlerData.icon,
                'item-dimmed': module.visible === 0 || module.uservisible === false
            }" detail="false">
            <ion-label>
                <core-format-text class="core-module-description" *ngIf="module.description" [maxHeight]="80" [text]="module.description"
                    contextLevel="module" [contextInstanceId]="module.id" [courseId]="module.course">
                </core-format-text>

                <!-- Activity dates. -->
                <div *ngIf="showActivityDates && module.dates && module.dates.length" class="core-module-dates">
                    <p *ngFor="let date of module.dates">
                        <ion-icon name="fas-calendar" aria-hidden="true"></ion-icon><strong>{{ date.label }}</strong> {{ date.timestamp *
                        1000 | coreFormatDate:'strftimedatetime' }}
                    </p>
                </div>

                <!-- Module completion. -->
                <core-course-module-completion *ngIf="module.completiondata && module.uservisible" [completion]="module.completiondata"
                    [moduleName]="module.name" [moduleId]="module.id" [showCompletionConditions]="showCompletionConditions"
                    [showManualCompletion]="showManualCompletion" (completionChanged)="completionChanged.emit($event)">
                </core-course-module-completion>

                <ion-chip *ngIf="module.completiondata?.offline" color="warning" class="ion-text-wrap block">
                    <ion-icon name="fas-sync" aria-hidden="true"></ion-icon>
                    <ion-label>{{ 'core.course.manualcompletionnotsynced' | translate }}</ion-label>
                </ion-chip>

                <!-- Availability -->
                <ion-chip *ngIf="module.visible === 0 && (!section || section.visible)" class="ion-text-wrap block">
                    <ion-icon name="fas-eye-slash" aria-hidden="true"></ion-icon>
                    <ion-label>{{ 'core.course.hiddenfromstudents' | translate }}</ion-label>
                </ion-chip>

                <ion-chip *ngIf="module.visible !== 0 && module.isStealth" class="ion-text-wrap block">
                    <ion-icon name="fas-eye-slash" aria-hidden="true"></ion-icon>
                    <ion-label>{{ 'core.course.hiddenoncoursepage' | translate }}</ion-label>
                </ion-chip>

                <ion-chip class="core-module-availabilityinfo ion-text-wrap block" *ngIf="module.availabilityinfo">
                    <ion-icon name="fas-lock" [attr.aria-label]="'core.restricted' | translate"></ion-icon>
                    <ion-label>
                        <core-format-text [text]="module.availabilityinfo" contextLevel="module" [contextInstanceId]="module.id"
                            [courseId]="module.course" class="ion-text-wrap">
                        </core-format-text>
                    </ion-label>
                </ion-chip>

            </ion-label>
        </ion-item>
    </ng-container>

    <!-- Loading. -->
    <ion-item *ngIf="module.handlerData.loading" role="status" class="ion-text-wrap" id="core-course-module-{{module.id}}"
        [attr.aria-label]="module.handlerData.a11yTitle"
        [ngClass]="['core-course-module-handler', 'core-module-loading', module.handlerData.class]" detail="false">
        <ion-label>
            <ion-spinner [attr.aria-label]="'core.loading' | translate"></ion-spinner>
        </ion-label>
    </ion-item>
</ion-card>
