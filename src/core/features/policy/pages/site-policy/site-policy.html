<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button [text]="'core.back' | translate" />
        </ion-buttons>

        <ion-title *ngIf="siteName">
            <h1><core-format-text [text]="siteName" contextLevel="system" [contextInstanceId]="0" /></h1>
        </ion-title>

        <ion-buttons slot="end">
            <ion-button fill="clear" (click)="cancel()" [attr.aria-label]="'core.cancel' | translate">
                <ion-icon name="fas-xmark" slot="icon-only" aria-hidden=true />
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>
<ion-content class="limited-width">
    <core-loading [hideUntil]="policyLoaded">
        <form *ngIf="policyForm" [formGroup]="policyForm" (ngSubmit)="submitAcceptances($event)">
            <ion-item class="ion-text-wrap">
                <ion-label>
                    <h2>{{ 'core.policy.policyagreement' | translate }}</h2>
                </ion-label>
            </ion-item>
            <hr>
            <ng-container *ngIf="isPoliciesURL && sitePoliciesURL">
                <ion-card class="core-info-card">
                    <ion-item class="ion-text-wrap">
                        <ion-icon name="fas-circle-info" slot="start" aria-hidden="true" />
                        <ion-label>
                            <p>{{ 'core.policy.policyagree' | translate }}</p>
                        </ion-label>
                    </ion-item>
                </ion-card>
                <ion-item class="ion-text-wrap core-site-policy-link">
                    <ion-label>
                        <p>
                            <a [href]="sitePoliciesURL" core-link [capture]="false">
                                {{ 'core.policy.policyagreementclick' | translate }}<ion-icon name="fas-up-right-from-square"
                                    aria-hidden="true" />
                            </a>
                        </p>
                    </ion-label>
                </ion-item>
                <div class="core-site-policy-iframe-container" [class.core-policy-has-iframe]="showInline">
                    <core-iframe *ngIf="showInline" [src]="sitePoliciesURL" />
                </div>
                <ion-item class="ion-text-wrap">
                    <ion-checkbox name="agreepolicy" formControlName="agreepolicy">
                        <span *ngIf="isManageAcceptancesAvailable" [core-mark-required]="true">
                            {{ 'core.policy.havereadandagreepolicy' | translate:{ policyname:'core.policy.policyagreement' | translate } }}
                        </span>
                        <span *ngIf="!isManageAcceptancesAvailable" [core-mark-required]="true">
                            {{ 'core.policy.policyacceptmandatory' | translate }}
                        </span>
                    </ion-checkbox>
                </ion-item>
                <ion-button type="submit" class="ion-text-wrap ion-margin-horizontal" expand="block" [disabled]="!policyForm.valid">
                    {{ 'core.continue' | translate }}
                </ion-button>
            </ng-container>
        </form>
    </core-loading>
</ion-content>
