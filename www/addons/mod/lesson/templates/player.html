<ion-view can-swipe-back="false">
    <ion-nav-title><mm-format-text watch="true">{{ title }}</mm-format-text></ion-nav-title>
    <ion-nav-buttons side="secondary">
        <button menu-toggle="right" ng-if="displayMenu || mediaFile" class="button button-icon icon ion-bookmark" aria-label="{{ 'mma.mod_lesson.lessonmenu' | translate }}"></button>
    </ion-nav-buttons>
    <ion-content mm-state-class delegate-handle="mmaModLessonPlayerScroll">
        <mm-loading hide-until="pageLoaded">
            <!-- Info messages. Only show the first one. -->
            <div class="mm-info-card" ng-if="lesson && messages && messages.length">
                <i class="icon ion-information-circled padding"></i> {{ messages[0].message }}
            </div>

            <div ng-class='{"mma-mod-lesson-slideshow": lesson.slideshow}' ng-style="{'width': lessonWidth, 'height': lessonHeight}">
                <mm-timer ng-if="endTime" end-time="endTime" finished="timeUp()" timer-text="{{ 'mma.mod_lesson.timeremaining' | translate }}"></mm-timer>

                <!-- Page content, including questions and buttons. -->
                <div ng-if="!eolData && !processData" class="list">
                    <mm-format-text ng-if="pageData.ongoingscore" class="item item-text-wrap mma-mod-lesson-ongoingscore" watch="true">{{pageData.ongoingscore}}</mm-format-text>
                    <p class="item item-text-wrap"><mm-format-text watch="true" component="{{component}}" component-id="{{lesson.coursemodule}}">{{pageContent}}</mm-format-text></p>
                    <form ng-if="question" name="mma-mod_lesson-player-form">
                        <input ng-repeat="input in question.hiddenInputs" type="hidden" name="{{input.name}}" value="{{input.value}}" />
                        <div ng-include="question.template"></div>
                        <div class="item">
                            <button class="button button-block" ng-click="submitQuestion()">{{ 'mma.mod_lesson.submit' | translate }}</button>
                        </div>
                    </form>
                    <div ng-if="pageButtons && pageButtons.length" class="item">
                        <button ng-repeat="button in pageButtons track by button.id" class="button button-block" id="{{button.id}}" title="{{button.title}}" ng-click="buttonClicked(button.data)">{{button.content}}</button>
                    </div>
                    <div ng-if="lesson.progressbar" class="item">
                        <p>{{ 'mma.mod_lesson.progresscompleted' | translate:{$a: pageData.progress} }}</p>
                        <progress max="100" value="{{pageData.progress}}"></progress>
                    </div>
                </div>

                <!-- End of lesson reached. -->
                <div ng-if="eolData && !processData" class="padding">
                    <h3 ng-if="eolData.gradelesson">{{ 'mma.mod_lesson.congratulations' | translate }}</h3>
                    <p ng-if="eolData.notenoughtimespent">{{ eolData.notenoughtimespent.message }}</p>
                    <p ng-if="eolData.numberofpagesviewed">{{ eolData.numberofpagesviewed.message }}</p>
                    <p ng-if="eolData.youshouldview">{{ eolData.youshouldview.message }}</p>
                    <p ng-if="eolData.numberofcorrectanswers">{{ eolData.numberofcorrectanswers.message }}</p>
                    <p ng-if="eolData.displayscorewithessays">{{ eolData.displayscorewithessays.message }}</p>
                    <p ng-if="!eolData.displayscorewithessays && eolData.displayscorewithoutessays">{{ eolData.displayscorewithoutessays.message }}</p>
                    <p ng-if="eolData.yourcurrentgradeisoutof">{{ eolData.yourcurrentgradeisoutof.message }}</p>
                    <p ng-if="eolData.eolstudentoutoftimenoanswers">{{ eolData.eolstudentoutoftimenoanswers.message }}</p>
                    <p ng-if="eolData.welldone">{{ eolData.welldone.message }}</p>
                    <div ng-if="lesson.progressbar && eolData.progressbar">
                        <p>{{ 'mma.mod_lesson.progresscompleted' | translate:{$a: eolProgress} }}</p>
                        <progress max="100" value="{{eolProgress}}"></progress>
                    </div>
                    <p ng-if="eolData.displayofgrade">{{ eolData.displayofgrade.message }}</p>
                    <p ng-if="eolData.reviewlesson">{{ eolData.reviewlesson.message }}</p>
                    <p ng-if="eolData.modattemptsnoteacher">{{ eolData.modattemptsnoteacher.message }}</p>
                    <mm-format-text ng-if="eolData.activitylink" watch="true">{{ eolData.activitylink.value }}</mm-format-text>
                    <!-- @todo Return & grade links. -->
                </div>

                <!-- Feedback returned when processing an action. -->
                <div ng-if="processData" class="list">
                    <mm-format-text ng-if="processData.ongoingscore && !processData.reviewmode" class="item item-text-wrap mma-mod-lesson-ongoingscore" watch="true">{{processData.ongoingscore}}</mm-format-text>
                    <p ng-if="!processData.reviewmode" class="item item-text-wrap"><mm-format-text watch="true" component="{{component}}" component-id="{{lesson.coursemodule}}">{{processData.feedback}}</mm-format-text></p>
                    <div ng-if="processData.buttons && processData.buttons.length" class="item">
                        <button ng-repeat="button in processData.buttons track by $index" class="button button-block" ng-click="loadPage(button.pageid, true)">{{ button.label | translate }}</button>
                    </div>
                </div>
            </div>

            <!-- List of questions templates. -->
            <script type="text/ng-template" id="truefalse">
                <ion-radio ng-repeat="option in question.options" id="{{option.id}}" name="{{option.name}}" ng-value="option.value" ng-model="question.model[option.name]">
                    <p><mm-format-text watch="true" component="{{component}}" component-id="{{componentId}}">{{option.text}}</mm-format-text></p>
                </ion-radio>
            </script>
        </mm-loading>
    </ion-content>
</ion-view>